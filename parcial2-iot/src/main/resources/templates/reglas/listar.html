<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Reglas</title>
    <meta charset="UTF-8"/>
    <link rel="stylesheet" href="/webjars/bootstrap/5.3.2/css/bootstrap.min.css"/>
</head>
<body class="p-4">
<h3>Reglas</h3>

<div class="row">
    <div class="col-md-7">
        <table class="table table-bordered table-sm align-middle">
            <thead>
            <tr>
                <th>Nombre</th>
                <th>Variable</th>
                <th>Expresión</th>
                <th>Severidad</th>
                <th>Ventana (s)</th>
                <th>Habilitada</th>
                <th>Acciones</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="r : ${reglas}">
                <td th:text="${r.nombre}"></td>
                <td th:text="${r.variablePlantilla.etiqueta != null ? r.variablePlantilla.etiqueta : r.variablePlantilla.nombre}"></td>
                <td th:text="${r.expresion}"></td>
                <td th:text="${r.severidad}"></td>
                <td th:text="${r.ventanaSegundos}"></td>
                <td>
                    <span th:text="${r.habilitada ? 'Sí' : 'No'}" th:classappend="${r.habilitada} ? 'text-success' : 'text-danger'"></span>
                </td>
                <td class="d-flex gap-1">
                    <form th:action="@{|/reglas/${r.id}/toggle|}" method="post">
                        <button class="btn btn-sm btn-secondary" type="submit">On/Off</button>
                    </form>
                    <form th:action="@{|/reglas/${r.id}/eliminar|}" method="post" onsubmit="return confirm('¿Eliminar regla?');">
                        <button class="btn btn-sm btn-danger" type="submit">Eliminar</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="col-md-5">
        <h5>Nueva/Editar Regla</h5>
        <form method="post" action="/reglas">
            <div class="mb-2">
                <label class="form-label">Variable</label>
                <select class="form-select" name="variablePlantillaId" required>
                    <option th:each="v : ${variables}" th:value="${v.id}"
                            th:text="${v.etiqueta != null ? v.etiqueta : v.nombre}"></option>
                </select>
            </div>
            <div class="mb-2">
                <label class="form-label">Nombre</label>
                <input class="form-control" name="nombre" required placeholder="Temp alta 5m"/>
            </div>
            <div class="mb-2">
                <label class="form-label">Expresión</label>
                <input class="form-control" name="expresion" required placeholder="avg_5m > 50"/>
            </div>
            <div class="mb-2">
                <label class="form-label">Severidad</label>
                <input class="form-control" name="severidad" value="info"/>
            </div>
            <div class="mb-2">
                <label class="form-label">Ventana (segundos)</label>
                <input class="form-control" name="ventanaSegundos" type="number" value="300" min="1"/>
                <div class="form-text">Si la expresión trae _5m/_30s/_1h, tiene prioridad sobre este valor.</div>
            </div>
            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" name="habilitada" checked/>
                <label class="form-check-label">Habilitada</label>
            </div>
            <button class="btn btn-primary">Guardar</button>
        </form>
    </div>
</div>
</body>
</html>
