<!-- templates/components/sidebar.html -->
<div th:fragment="sidebar">
    <!-- Overlay móvil -->
    <div class="sidebar-backdrop" onclick="closeSidebar()" tabindex="-1"></div>

    <!-- Sidebar -->
    <aside id="appSidebar" class="app-sidebar" aria-label="Menú lateral" role="navigation">
        <header class="sidebar-header">
            <span class="brand">
                <strong class="brand-full">IoT&nbsp;Admin</strong>
                <strong class="brand-compact" aria-hidden="true">IA</strong>
            </span>

            <!-- Toggle desktop/móvil -->
            <button type="button" class="sidebar-toggle"
                    aria-label="Colapsar/expandir menú"
                    aria-controls="appSidebar"
                    aria-pressed="false"
                    onclick="toggleSidebar()">☰</button>
        </header>

        <!-- Navegación -->
        <nav class="sidebar-nav" th:with="currentNav=${nav} ?: ''">
            <ul>
                <li>
                    <a th:href="@{/dashboard}" th:classappend="${currentNav == 'dashboard'} ? ' active'">
                        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                            <path fill="currentColor" d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                        </svg>
                        <span class="link-label">Dashboard</span>
                    </a>
                </li>
                <li>
                    <a th:href="@{/paneles}" th:classappend="${currentNav == 'paneles'} ? ' active'">
                        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                            <path fill="currentColor" d="M3 3h8v8H3V3zm10 0h8v5h-8V3zM3 13h5v8H3v-8zm7 5h11v3H10v-3z"/>
                        </svg>
                        <span class="link-label">Paneles</span>
                    </a>
                </li>

                <li>
                    <a th:href="@{/plantillas}" th:classappend="${currentNav == 'plantillas'} ? ' active'">
                        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                            <path fill="currentColor" d="M14 2H6a2 2 0 0 0-2 2v14l4-2 4 2 4-2 4 2V8zM6 4h7v4H6z"/>
                        </svg>
                        <span class="link-label">Plantillas</span>
                    </a>
                </li>

                <li>
                    <a th:href="@{/dispositivos}" th:classappend="${currentNav == 'dispositivos'} ? ' active'">
                        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                            <path fill="currentColor" d="M12 20a2 2 0 0 1-2-2h4a2 2 0 0 1-2 2zm6-6v-3a6 6 0 0 0-12 0v3l-2 2v1h16v-1l-2-2zM12 4a4 4 0 0 1 4 4v3H8V8a4 4 0 0 1 4-4z"/>
                        </svg>
                        <span class="link-label">Dispositivos</span>
                    </a>
                </li>

                <li>
                    <a th:href="@{/telemetria}" th:classappend="${currentNav == 'telemetria'} ? ' active'">
                        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                            <path fill="currentColor" d="M3 3v18h18v-2H5V3H3zm16 4-4 7-3-3-4 6h14l-3-10z"/>
                        </svg>
                        <span class="link-label">Telemetría</span>
                    </a>
                </li>

                <!-- NUEVO: Reglas -->
                <li>
                    <a th:href="@{/reglas}" th:classappend="${currentNav == 'reglas'} ? ' active'">
                        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                            <path fill="currentColor"
                                  d="M4 4h16v2H4V4zm2 5h12v2H6V9zm-2 5h16v2H4v-2zm2 5h8v2H6v-2z"/>
                        </svg>
                        <span class="link-label">Reglas</span>
                    </a>
                </li>

                <!-- NUEVO: Alertas -->
                <li>
                    <a th:href="@{/alertas}" th:classappend="${currentNav == 'alertas'} ? ' active'">
                        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                            <path fill="currentColor"
                                  d="M1 21h22L12 2 1 21zm12-3h-2v2h2v-2zm0-6h-2v4h2v-4z"/>
                        </svg>
                        <span class="link-label">Alertas</span>
                    </a>
                </li>

                <li>
                    <a th:href="@{/estado}" th:classappend="${currentNav == 'estado'} ? ' active'">
                        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                            <path fill="currentColor"
                                  d="M3 5h18v2H3V5zm3 6h4v8H6v-8zm6-4h4v12h-4V7zm6 6h4v6h-4v-6z"/>
                        </svg>
                        <span class="link-label">Estado</span>
                    </a>
                </li>

                <li>
                    <a th:href="@{/comandos}" th:classappend="${currentNav == 'comandos'} ? ' active'">
                        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                            <path fill="currentColor"
                                  d="M3 5h18v2H3V5zm2 5h10v2H5v-2zm0 5h7v2H5v-2zm12-5h4v2h-4v-2zm0 5h4v2h-4v-2z"/>
                        </svg>
                        <span class="link-label">Comandos</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Footer con control de tema -->
        <div class="sidebar-footer p-3">
            <button id="themeToggle" class="btn btn-outline-light w-100" type="button"
                    aria-pressed="false" aria-label="Alternar tema">
                <i class="bi bi-sun-fill me-2" aria-hidden="true"></i>
                <span class="theme-label">Modo Claro</span>
            </button>
        </div>
    </aside>

    <!-- Botón flotante móvil para abrir menú -->
    <button class="sidebar-fab" type="button" onclick="toggleSidebar()" aria-label="Abrir menú lateral">
        <i class="bi bi-list" aria-hidden="true"></i>
    </button>
</div>
